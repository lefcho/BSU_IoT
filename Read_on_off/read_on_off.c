// Деклариране на променливите
int i;  // Текущо състояние на сензора (0 или 1)
int j;  // Предходно състояние на сензора

// Дефиниране на пиновете
int LED1 = 33;    // Пин за светодиод – GPIO33 (или използвай GPIO2 за вграден)
int Touch1 = 13;  // Пин за вход от сензор или бутон – GPIO13

// Първоначална инициализация - изпълнява се веднъж при стартиране
// На практика тук се реализира операционната система на вашето IoT устройство
void setup() 
{
  // Инициализиране на начални стойности
  i = 0;
  j = -1;  // -1 за да гарантираме, че първото сравнение ще отчете промяна

  // Стартиране на серийна комуникация за дебъгване
  Serial.begin(115200);

  // Настройка на пиновете – LED като изход, сензор като вход
  pinMode(LED1, OUTPUT);
  pinMode(Touch1, INPUT);

  // Кратък тест на светодиода при стартиране
  digitalWrite(LED1, HIGH);
  delay(300);
  digitalWrite(LED1, LOW);

  // Информационни съобщения
  Serial.println("СТАРТ НА СИСТЕМАТА");
  Serial.println("Очакване на контакт със сензора...");
}

// Основен цикъл – изпълнява се непрекъснато
void loop()
{
  // Четене на текущото състояние на сензора – 0 (няма контакт) или 1 (има контакт)
  i = digitalRead(Touch1);

  // Проверка дали има промяна в състоянието от предишния цикъл
  if (i != j)
  {
    // Ако е отчетен контакт (вход = HIGH / 1)
    if (i == 1) {
      Serial.println("ОТЧЕТЕН Е КОНТАКТ СЪС СЕНЗОРА. Ниво: 1");
      digitalWrite(LED1, HIGH);  // Включване на светодиода
    } 
    // Ако няма контакт (вход = LOW / 0)
    else {
      Serial.println("Няма контакт. Ниво: 0");
      digitalWrite(LED1, LOW);   // Изключване на светодиода
    }
  }

  // Запомняме текущото състояние за следващо сравнение
  j = i;

  // Кратко закъснение за стабилизиране на четенето на бутона (анти-дебаунс)
  delay(10);
}
